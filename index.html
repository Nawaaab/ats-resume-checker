<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<title>Free ATS Resume Checker</title>
<meta name="viewport" content="width=device-width, initial-scale=1.0">

<!-- PDF.js -->
<script src="https://cdnjs.cloudflare.com/ajax/libs/pdf.js/2.16.105/pdf.min.js"></script>
<script>
pdfjsLib.GlobalWorkerOptions.workerSrc =
  "https://cdnjs.cloudflare.com/ajax/libs/pdf.js/2.16.105/pdf.worker.min.js";
</script>

<!-- DOCX -->
<script src="https://unpkg.com/mammoth/mammoth.browser.min.js"></script>

<style>
body { font-family: Arial; background:#f4f4f4; }
.container { max-width:900px; margin:auto; background:#fff; padding:20px; }
textarea, input { width:100%; padding:10px; margin-bottom:15px; }
button { width:100%; padding:14px; background:#0a66c2; color:#fff; border:none; font-size:16px; }
.result { display:none; margin-top:20px; }
.green { color:green; }
.orange { color:orange; }
.red { color:red; }
.fix { background:#fafafa; padding:10px; margin-bottom:12px; }
.old { text-decoration:line-through; color:red; }
.new { color:green; font-weight:bold; }
</style>
</head>

<body>
<div class="container">

<h1>Free ATS Resume Checker</h1>

<h3>Upload Resume (PDF or DOCX)</h3>
<input type="file" id="resumeFile" accept=".pdf,.docx">

<h3>Job Description / KPIs</h3>
<textarea id="jobDesc" placeholder="Paste job description here..."></textarea>

<button onclick="runATS()">Check ATS Score</button>

<div class="result" id="result">
  <h2>ATS Score</h2>
  <h1 id="score"></h1>

  <h3>Line-by-Line Improvements</h3>
  <div id="fixes"></div>
</div>

</div>

<script>
async function runATS() {
  const file = document.getElementById("resumeFile").files[0];
  const jd = document.getElementById("jobDesc").value.toLowerCase();

  if (!file || jd.length < 30) {
    alert("Upload resume and paste job description.");
    return;
  }

  let resumeText = "";
  try {
    resumeText = file.type === "application/pdf"
      ? await readPDF(file)
      : await readDOCX(file);
  } catch {
    alert("Could not read file. Try another resume.");
    return;
  }

  computeATS(resumeText, jd);
}

async function readPDF(file) {
  const buffer = await file.arrayBuffer();
  const pdf = await pdfjsLib.getDocument({ data: buffer }).promise;
  let text = "";
  for (let i = 1; i <= pdf.numPages; i++) {
    const page = await pdf.getPage(i);
    const content = await page.getTextContent();
    content.items.forEach(item => text += item.str + "\n");
  }
  return text;
}

async function readDOCX(file) {
  const buffer = await file.arrayBuffer();
  const result = await mammoth.extractRawText({ arrayBuffer: buffer });
  return result.value || "";
}

function computeATS(resume, jd) {
  const resumeLower = resume.toLowerCase();
  const lines = resume.split("\n").filter(l => l.trim().length > 10);
  const keywords = extractKeywords(jd);

  /* 1. Keyword Match (45%) */
  const keywordHits = keywords.filter(k => resumeLower.includes(k)).length;
  const keywordScore = ratio(keywordHits, keywords.length);

  /* 2. Skills Alignment (25%) */
  const skills = keywords.filter(k => k.length >= 5);
  const skillHits = skills.filter(s => resumeLower.includes(s)).length;
  const skillScore = ratio(skillHits, skills.length);

  /* 3. Role & Title Match (15%) */
  const roleScore = keywords.some(k => resumeLower.includes(k)) ? 1 : 0;

  /* 4. Experience Relevance (10%) */
  const relevantLines = lines.filter(l =>
    /\b(led|managed|built|improved|designed|executed)\b/i.test(l)
  ).length;
  const experienceScore = ratio(relevantLines, lines.length);

  /* 5. ATS Hygiene (5%) */
  const hygieneScore =
    resume.includes("|") || resume.includes("â€¢") ? 0.6 : 1;

  const finalScore = Math.round(
    (
      keywordScore * 0.45 +
      skillScore * 0.25 +
      roleScore * 0.15 +
      experienceScore * 0.10 +
      hygieneScore * 0.05
    ) * 100
  );

  render(finalScore, lines, keywords);
}

function extractKeywords(text) {
  return [...new Set(text.match(/\b[a-z]{4,}\b/g) || [])].slice(0, 30);
}

function ratio(a, b) {
  return b === 0 ? 0 : Math.min(1, a / b);
}

function render(score, lines, keywords) {
  const scoreEl = document.getElementById("score");
  scoreEl.innerText = score + "%";
  scoreEl.className = score >= 70 ? "green" : score >= 50 ? "orange" : "red";

  const fixes = document.getElementById("fixes");
  fixes.innerHTML = "";

  if (score < 70) {
    let shown = 0;
    lines.forEach(line => {
      if (shown >= 5) return;
      if (!keywords.some(k => line.toLowerCase().includes(k))) {
        fixes.innerHTML += `
          <div class="fix">
            <div class="old">${line}</div>
            <div class="new">Led ${keywords[shown] || "key"} initiatives aligned with job KPIs and measurable impact.</div>
          </div>
        `;
        shown++;
      }
    });
  } else {
    fixes.innerHTML = "<p>Your resume is well aligned with this role.</p>";
  }

  document.getElementById("result").style.display = "block";
}
</script>

</body>
</html>
