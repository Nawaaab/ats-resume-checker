<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<title>Free ATS Resume Checker</title>
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<meta name="description" content="Upload resume PDF or Word and check ATS score using keyword match, skills alignment, role match, experience relevance, and ATS hygiene.">

<script src="https://cdnjs.cloudflare.com/ajax/libs/pdf.js/2.16.105/pdf.min.js"></script>
<script src="https://unpkg.com/mammoth/mammoth.browser.min.js"></script>

<style>
body { font-family: Arial; background:#f4f4f4; }
.container { max-width:900px; background:#fff; margin:auto; padding:20px; }
textarea, input { width:100%; padding:10px; margin-bottom:15px; }
button { width:100%; padding:14px; background:#0a66c2; color:#fff; border:none; font-size:16px; cursor:pointer; }
.result { display:none; margin-top:20px; }
.green { color:green; }
.orange { color:orange; }
.red { color:red; }
.fix { background:#fafafa; padding:10px; margin-bottom:12px; }
.old { text-decoration:line-through; color:red; }
.new { color:green; font-weight:bold; }
</style>
</head>

<body>
<div class="container">

<h1>Free ATS Resume Checker</h1>

<h3>Upload Resume (PDF / DOCX)</h3>
<input type="file" id="resumeFile" accept=".pdf,.docx">

<h3>Job Description / KPIs</h3>
<textarea id="jobDesc" placeholder="Paste job description here..."></textarea>

<button onclick="runATS()">Check ATS Score</button>

<div class="result" id="result">
  <h2>ATS Score</h2>
  <h1 id="score"></h1>

  <h3>Line-by-Line Improvements</h3>
  <div id="fixes"></div>
</div>

</div>

<script>
async function runATS() {
  const file = document.getElementById("resumeFile").files[0];
  const jd = document.getElementById("jobDesc").value.toLowerCase();

  if (!file || jd.length < 50) {
    alert("Upload resume and paste full job description.");
    return;
  }

  const resumeText = file.type === "application/pdf"
    ? await readPDF(file)
    : await readDOCX(file);

  calculateScore(resumeText, jd);
}

async function readPDF(file) {
  const buffer = await file.arrayBuffer();
  const pdf = await pdfjsLib.getDocument({ data: buffer }).promise;
  let text = "";
  for (let i = 1; i <= pdf.numPages; i++) {
    const page = await pdf.getPage(i);
    const content = await page.getTextContent();
    content.items.forEach(item => text += item.str + "\n");
  }
  return text;
}

async function readDOCX(file) {
  const buffer = await file.arrayBuffer();
  const result = await mammoth.extractRawText({ arrayBuffer: buffer });
  return result.value;
}

function calculateScore(resume, jd) {
  const resumeLines = resume.split("\n").filter(l => l.trim().length > 12);
  const jdWords = extractWords(jd);
  const resumeLower = resume.toLowerCase();

  /* 1. Keyword Match (45%) */
  const keywordHits = jdWords.filter(w => resumeLower.includes(w)).length;
  const keywordScore = safeDivide(keywordHits, jdWords.length);

  /* 2. Skills Alignment (25%) */
  const skillWords = jdWords.filter(w => w.length >= 5);
  const skillHits = skillWords.filter(w => resumeLower.includes(w)).length;
  const skillScore = safeDivide(skillHits, skillWords.length);

  /* 3. Role & Title Match (15%) */
  const roleScore = jd.includes("manager") && resumeLower.includes("manager") ? 1 :
                    jd.includes("engineer") && resumeLower.includes("engineer") ? 1 :
                    jd.includes("analyst") && resumeLower.includes("analyst") ? 1 : 0;

  /* 4. Experience Relevance (10%) */
  let relevantLines = 0;
  resumeLines.forEach(l => {
    if (/\b(led|managed|built|improved|increased|designed|executed)\b/i.test(l)
        && /\d+/.test(l)) relevantLines++;
  });
  const experienceScore = safeDivide(relevantLines, resumeLines.length);

  /* 5. ATS Hygiene (5%) */
  let hygienePenalty = resume.includes("|") || resume.includes("â€¢") ? 0.7 : 1;

  /* Final Weighted Score */
  const finalScore = Math.round(
    (
      keywordScore * 0.45 +
      skillScore * 0.25 +
      roleScore * 0.15 +
      experienceScore * 0.10 +
      hygienePenalty * 0.05
    ) * 100
  );

  renderScore(finalScore);
  generateFixes(resumeLines, jdWords, finalScore);
}

function extractWords(text) {
  return [...new Set((text.match(/\b[a-z]{4,}\b/g) || []))].slice(0, 40);
}

function safeDivide(a, b) {
  return b === 0 ? 0 : Math.min(1, a / b);
}

function renderScore(score) {
  const el = document.getElementById("score");
  el.innerText = score + "%";
  el.className = score >= 70 ? "green" : score >= 50 ? "orange" : "red";
  document.getElementById("result").style.display = "block";
}

function generateFixes(lines, keywords, score) {
  const box = document.getElementById("fixes");
  box.innerHTML = "";

  if (score >= 70) {
    box.innerHTML = "<p>Your resume is well aligned with the job description.</p>";
    return;
  }

  let shown = 0;
  lines.forEach(line => {
    if (shown >= 6) return;
    const hasKeyword = keywords.some(k =
