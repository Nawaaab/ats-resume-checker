<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<title>Free ATS Resume Checker</title>
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<meta name="description" content="Upload resume PDF or Word and check ATS score with full breakdown and line-by-line improvements.">

<!-- PDF.js -->
<script src="https://cdnjs.cloudflare.com/ajax/libs/pdf.js/2.16.105/pdf.min.js"></script>
<script>
pdfjsLib.GlobalWorkerOptions.workerSrc =
  "https://cdnjs.cloudflare.com/ajax/libs/pdf.js/2.16.105/pdf.worker.min.js";
</script>

<!-- DOCX -->
<script src="https://unpkg.com/mammoth/mammoth.browser.min.js"></script>

<style>
body { font-family: Arial, sans-serif; background:#f4f4f4; }
.container { max-width:900px; background:#fff; margin:30px auto; padding:20px; }
textarea, input { width:100%; padding:10px; margin-bottom:15px; }
button { width:100%; padding:14px; background:#0a66c2; color:#fff; border:none; font-size:16px; cursor:pointer; }
.result { display:none; margin-top:20px; }
.green { color:green; }
.orange { color:orange; }
.red { color:red; }
.fix { background:#fafafa; padding:12px; margin-bottom:14px; }
.old { color:#c0392b; text-decoration:line-through; }
.new { color:#1e7e34; font-weight:bold; margin-top:4px; }
.status { font-size:14px; color:#555; margin-bottom:10px; }
</style>
</head>

<body>
<div class="container">

<h1>Free ATS Resume Checker</h1>

<h3>Upload Resume (PDF or DOCX)</h3>
<input type="file" id="resumeFile" accept=".pdf,.docx">
<div class="status" id="status">Resume not loaded</div>

<h3>Job Description / KPIs</h3>
<textarea id="jobDesc" placeholder="Paste full job description here..."></textarea>

<button onclick="calculateATS()">Check ATS Score</button>

<div class="result" id="result">
  <h2>ATS Score</h2>
  <h1 id="score"></h1>

  <div id="breakdown" style="margin-bottom:20px;"></div>

  <h3>Line-by-Line Improvements</h3>
  <div id="fixes"></div>
</div>

</div>

<script>
let RESUME_TEXT = "";

/* ================= FILE LOADING ================= */

document.getElementById("resumeFile").addEventListener("change", async function () {
  const file = this.files[0];
  document.getElementById("status").innerText = "Loading resume…";

  try {
    if (file.type === "application/pdf") {
      RESUME_TEXT = await readPDF(file);
    } else {
      RESUME_TEXT = await readDOCX(file);
    }
    document.getElementById("status").innerText = "Resume loaded successfully";
  } catch {
    RESUME_TEXT = "";
    document.getElementById("status").innerText = "Failed to read resume file";
  }
});

async function readPDF(file) {
  const buffer = await file.arrayBuffer();
  const pdf = await pdfjsLib.getDocument({ data: buffer }).promise;
  let text = "";
  for (let i = 1; i <= pdf.numPages; i++) {
    const page = await pdf.getPage(i);
    const content = await page.getTextContent();
    content.items.forEach(item => text += item.str + "\n");
  }
  return text;
}

async function readDOCX(file) {
  const buffer = await file.arrayBuffer();
  const result = await mammoth.extractRawText({ arrayBuffer: buffer });
  return result.value || "";
}

/* ================= ATS SCORING ================= */

function calculateATS() {
  const jd = document.getElementById("jobDesc").value.toLowerCase();

  if (RESUME_TEXT.length < 50 || jd.length < 50) {
    alert("Please upload resume and paste full job description.");
    return;
  }

  const resume = RESUME_TEXT.toLowerCase();
  const resumeLines = resume.split("\n").filter(l => l.trim().length > 12);
  const jdKeywords = extractKeywords(jd);

  // 1. Keyword Match (45%)
  const keywordHits = jdKeywords.filter(k => resume.includes(k)).length;
  const keywordScore = ratio(keywordHits, jdKeywords.length);

  // 2. Skills Alignment (25%)
  const skillWords = jdKeywords.filter(k => k.length >= 5);
  const skillHits = skillWords.filter(k => resume.includes(k)).length;
  const skillScore = ratio(skillHits, skillWords.length);

  // 3. Role & Title Match (15%)
  const roleScore = jdKeywords.some(k => resume.includes(k)) ? 1 : 0;

  // 4. Experience Relevance (10%)
  const experienceLines = resumeLines.filter(l =>
    /\b(led|managed|built|improved|designed|executed|delivered|scaled)\b/i.test(l)
  ).length;
  const experienceScore = ratio(experienceLines, resumeLines.length);

  // 5. ATS Hygiene (5%)
  const hygieneScore =
    resume.includes("|") || resume.includes("•") ? 0.6 : 1;

  const breakdown = {
    keyword: Math.round(keywordScore * 45),
    skills: Math.round(skillScore * 25),
    role: Math.round(roleScore * 15),
    experience: Math.round(experienceScore * 10),
    hygiene: Math.round(hygieneScore * 5)
  };

  const finalScore =
    breakdown.keyword +
    breakdown.skills +
    breakdown.role +
    breakdown.experience +
    breakdown.hygiene;

  renderOutput(finalScore, breakdown, resumeLines, jdKeywords);
}

function extractKeywords(text) {
  return [...new Set(text.match(/\b[a-z]{4,}\b/g) || [])].slice(0, 40);
}

function ratio(a, b) {
  return b === 0 ? 0 : Math.min(1, a / b);
}

/* ================= SMART REWRITES ================= */

function classifyJDKeywords(jdKeywords) {
  return {
    strategy: jdKeywords.filter(k => ["strategy","roadmap","vision","stakeholder"].includes(k)),
    data: jdKeywords.filter(k => ["data","analytics","insights","metrics","kpi"].includes(k)),
    product: jdKeywords.filter(k => ["product","platform","feature","launch"].includes(k)),
    growth: jdKeywords.filter(k => ["growth","adoption","acquisition","engagement","marketing"].includes(k))
  };
}

function classifyResumeLine(line) {
  const l = line.toLowerCase();
  if (l.includes("data") || l.includes("insight")) return "data";
  if (l.includes("product") || l.includes("platform")) return "product";
  if (l.includes("growth") || l.includes("adoption")) return "growth";
  if (l.includes("strategy") || l.includes("stakeholder")) return "strategy";
  return "general";
}

function improveLine(originalLine, jdKeywords) {
  const context = classifyResumeLine(originalLine);
  const jdGroups = classifyJDKeywords(jdKeywords);

  const verbs = {
    strategy: ["Defined", "Drove", "Owned"],
    data: ["Analyzed", "Leveraged", "Synthesized"],
    product: ["Built", "Launched", "Scaled"],
    growth: ["Accelerated", "Expanded", "Increased"],
    general: ["Led", "Executed", "Delivered"]
  };

  const verb = verbs[context][Math.floor(Math.random() * verbs[context].length)];
  const relevant =
    jdGroups[context]?.length ? jdGroups[context].slice(0,2) : jdKeywords.slice(0,2);

  const metrics = [
    "driving ~20% impact",
    "supporting ₹X revenue growth",
    "impacting 1M+ users",
    "improving efficiency by ~25%"
  ];

  return `${verb} ${relevant.join(" and ")} initiatives, ${metrics[Math.floor(Math.random() * metrics.length)]}, aligned with role KPIs and business outcomes.`;
}

/* ================= OUTPUT ================= */

function renderOutput(score, breakdown, lines, jdKeywords) {
  const scoreEl = document.getElementById("score");
  scoreEl.innerText = score + "%";
  scoreEl.className = score >= 70 ? "green" : score >= 50 ? "orange" : "red";

  const breakdownDiv = document.getElementById("breakdown");
  breakdownDiv.innerHTML = `
    <h3>Score Breakdown</h3>
    <ul style="list-style:none;padding-left:0;">
      <li>Keyword Match: <strong>${breakdown.keyword}</strong> / 45</li>
      <li>Skills Alignment: <strong>${breakdown.skills}</strong> / 25</li>
      <li>Role & Title Match: <strong>${breakdown.role}</strong> / 15</li>
      <li>Experience Relevance: <strong>${breakdown.experience}</strong> / 10</li>
      <li>ATS Hygiene: <strong>${breakdown.hygiene}</strong> / 5</li>
    </ul>
  `;

  const fixes = document.getElementById("fixes");
  fixes.innerHTML = "";

  if (score < 70) {
    let shown = 0;
    lines.forEach(line => {
      if (shown >= 6) return;
      if (!jdKeywords.some(k => line.includes(k))) {
        fixes.innerHTML += `
          <div class="fix">
            <div class="old">${line}</div>
            <div class="new">${improveLine(line, jdKeywords)}</div>
          </div>
        `;
        shown++;
      }
    });
  } else {
    fixes.innerHTML = "<p>Your resume already aligns well with this role.</p>";
  }

  document.getElementById("result").style.display = "block";
}
</script>

</body>
</html>

